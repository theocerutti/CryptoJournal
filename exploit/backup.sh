#!/bin/bash

#
# Running in cron job: 0 1 * * *
# Every one week.
#

# Create backups directory
mkdir -p /home/ubuntu/backups

# Compress bwdata folder
backup_name=db-$(date +"%Y-%m-%d").tar
pg_dump -U postgres --no-password -h 127.0.0.1 -p 5432 --format=tar --file="/home/ubuntu/backups/db-$(date +"%Y-%m-%d").tar" postgres

# Cleanup backup older than 15 days
find /home/ubuntu/backups -name "*.tar" -type f -mtime +15 -exec rm {} \;
